pipeline {
  agent any

  stages {
    stage('Clone source code') 
    }

    stage('Provision infrastructure with Terraform') {
      steps {
        sh 'terraform init'
        sh 'terraform apply -auto-approve'
      }
    }

    stage('Configure WordPress with Ansible') {
      steps {
        ansiblePlaybook(
          playbook: '/path/to/playbook.yml',
          inventory: 'hosts.ini'
        )
      }
    }

    stage('Send notification to Telegram') {
      steps {
        telegramSend(
          message: 'WordPress has been deployed successfully!',
          tokenCredentialId: '<telegram_token_credential_id>',
          chatId: '<telegram_chat_id>'
        )
      }
    }
  }

  post {
    always {
      sh 'terraform destroy -auto-approve'
    }
  }
}
